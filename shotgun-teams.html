<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shotgun League - Season 5 Preview</title>
  <style>
    :root {
      --bg: #020617; --card-bg: #0b1120;
      --accent: #22c55e; --accent-soft: rgba(34, 197, 94, 0.2);
      --text-main: #e5e7eb; --text-muted: #9ca3af;
      --border-soft: rgba(148, 163, 184, 0.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#0f172a 0,#020617 55%);
      color:var(--text-main);
      display:flex;align-items:flex-start;justify-content:center;padding:2rem 1rem;
    }
    .container{width:100%;max-width:960px}
    .header{
      margin-bottom:1.5rem;padding:1.25rem 1.5rem;border-radius:1rem;
      background:linear-gradient(135deg,rgba(15,23,42,.95),rgba(15,118,110,.6));
      border:1px solid rgba(148,163,184,.4);
      box-shadow:0 18px 45px rgba(0,0,0,.65),0 0 0 1px rgba(15,23,42,.8);
    }
    .header-title{font-size:1.4rem;font-weight:700;display:flex;gap:.6rem}
    .pill{
      display:inline-flex;gap:.35rem;border-radius:999px;
      padding:.1rem .7rem;font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;
      background:rgba(15,23,42,.8);border:1px solid rgba(148,163,184,.5);color:var(--text-muted);
    }
    .pill-dot{
      width:.45rem;height:.45rem;border-radius:999px;
      background:var(--accent);box-shadow:0 0 0 4px rgba(34,197,94,.35)
    }
    .embed-preview{
      border-radius:1.25rem;padding:1.25rem;
      background:radial-gradient(circle at top left,rgba(34,197,94,.12),transparent 55%),
                 radial-gradient(circle at bottom right,rgba(59,130,246,.12),transparent 55%),
                 var(--card-bg);
      border:1px solid var(--border-soft);
      box-shadow:0 18px 40px rgba(15,23,42,.85),0 0 0 1px rgba(15,23,42,.9);
      position:relative;overflow:hidden;
    }
    .embed-accent{
      position:absolute;left:0;top:0;bottom:0;width:4px;
      background:linear-gradient(to bottom,var(--accent),#16a34a);
    }
    .embed-header{
      margin:0 0 .75rem .75rem;
      display:flex;justify-content:space-between;align-items:center;
    }
    .rows{
      margin-top:.75rem;border-radius:.9rem;background:rgba(15,23,42,.9);
      border:1px solid rgba(55,65,81,.9);padding:.4rem .6rem;
      max-height:480px;overflow-y:auto;
    }
    .row{
      display:grid;grid-template-columns:0.6fr 1fr 1fr;gap:.75rem;
      padding:.45rem .5rem;align-items:center;
      border-bottom:1px solid rgba(31,41,55,.9);font-size:.8rem;
    }
    .row-rank{display:inline-flex;gap:.4rem;font-weight:600}
    .rank-pill{
      width:1.4rem;height:1.4rem;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      border:1px solid rgba(148,163,184,.75);
      background:radial-gradient(circle at top,var(--accent-soft),rgba(15,23,42,.9));
    }
    .cell-value{font-variant-numeric:tabular-nums;text-align:right}
    .loading{padding:.8rem;font-size:.85rem;color:var(--text-muted)}
    .error{
      padding:.8rem;font-size:.85rem;color:#fecaca;background:rgba(127,29,29,.4);
      border-radius:.6rem;border:1px solid rgba(248,113,113,.5);margin-top:.5rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="pill"><span class="pill-dot"></span>Shotgun League â€¢ Season 5</div>
      <div class="header-title">Range Preview: Season 5!U4:X15</div>
      <div class="header-sub">Live standings pulled from Google Sheets ðŸ”„</div>
    </div>

    <div class="embed-preview">
      <div class="embed-accent"></div>

      <div class="embed-header">
        <div>
          <div class="embed-title">Season 5 Standings</div>
          <div class="embed-subtitle">Live via Cloudflare Worker</div>
        </div>
        <div class="embed-badge" id="row-count-badge">Loading rowsâ€¦</div>
      </div>

      <div id="status" class="loading">Fetching standingsâ€¦</div>
      <div class="rows" id="rows" style="display:none;"></div>
    </div>
  </div>

<script>
  const WORKER_URL = "https://small-mud-2771.nextweekmedia.workers.dev/";
  const SHEET_ID = "1qIM0HKhx9Y-3eCJCFzBqrbATwiPrK3C1ynATwZzRC1o";
  const RANGE = "Season 5!U4:X30"; // Extended to ensure no crop

  async function fetchSheetRange() {
    const res = await fetch(`${WORKER_URL}?sheetId=${SHEET_ID}&range=${encodeURIComponent(RANGE)}`);
    if (!res.ok) throw new Error("Worker fetch failed: " + res.status);
    const json = await res.json();
    return json.values || [];
  }

  function renderData(values) {
    const rowsContainer = document.getElementById("rows");
    const status = document.getElementById("status");
    const rowCountBadge = document.getElementById("row-count-badge");

    status.style.display = "none";
    rowsContainer.style.display = "block";

    const rows = values; // No header in this sheet section

    let count = 0;
    rowsContainer.innerHTML = "";

    rows.forEach((row) => {
      const rank = row[0];
      const name = row[2];
      const score = row[3];

      if (!name) return;

      const rowEl = document.createElement("div");
      rowEl.className = "row";
      rowEl.innerHTML = `
        <div class="row-rank"><span class="rank-pill">${rank}</span>${name}</div>
        <div class="cell-value">${score ?? "â€“"}</div>
        <div class="cell-value"></div>
      `;

      rowsContainer.appendChild(rowEl);
      count++;
    });

    rowCountBadge.textContent = count > 0 ? `${count} rows loaded` : "No rows found";
  }

  async function init() {
    try {
      const values = await fetchSheetRange();
      renderData(values);
    } catch (err) {
      console.error(err);
      document.getElementById("status").className = "error";
      document.getElementById("status").textContent = "Error loading data.";
      document.getElementById("row-count-badge").textContent = "Error";
    }
  }

  init();
</script>

</body>
</html>
