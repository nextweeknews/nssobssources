<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Season 5 Team Standings</title>

  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      background: transparent;
      font-family: Inter, system-ui, sans-serif;
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
    }

    .card {
      width: 1100px;
      height: 880px;
      background: rgba(15,23,42,1);
      border-radius: 20px;
      padding: 32px 40px;
      display: flex;
      flex-direction: column;
      color: #e9eef8;
      box-shadow: 0 32px 32px rgba(0,0,0,0.65);
      box-sizing: border-box;
    }

    .title {
      font-size: 46px;
      font-weight: 900;
      color: #c7d7ff;
      text-align: center;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: .035em;
      flex-shrink: 0;
    }

    .header-row, .entry {
      display: grid;
      grid-template-columns: 120px 1fr 130px; /* Rank, Team, Score */
      align-items: center;
    }

    .header-row {
      height: 46px;
      margin-bottom: 10px;
      background: rgba(148,163,184,0.12);
      border-radius: 10px;
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      color: #9ca3c7;
      flex-shrink: 0;
    }

    #resultsList {
      display: flex;
      flex-direction: column;
      gap: 6px;
      flex-shrink: 1;
      transition: opacity .3s ease, gap .3s ease;
      overflow: hidden;
    }

    .entry {
      height: 60px;
      background: rgba(255,255,255,0.06);
      border-radius: 10px;      /* outer corners only */
      font-size: 24px;
      font-weight: 600;
      transition: background .25s ease, box-shadow .25s ease;
      overflow: hidden;         /* clip logo nicely inside row */
    }

    /* Base cell styling */
    .header-row span {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
      box-sizing: border-box;
      height: 20px;
      right: -1;
      border-right: none;
    }

    .entry > span {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
      box-sizing: border-box;
      height: 100%;
      right: -1;
      border-right: none;
    }

    /* Header "Team" alignment only */
    .header-row span:nth-child(2) {
      justify-content: flex-start;
      padding-left: 24px;
    }

    .place {
      font-size: 32px;
      font-weight: 750;
      text-align: center;
      color: #c7d7ff;
    }

    .player-name {
      font-size: 34px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Team cell (color bar + caps text + logo) */
    .team-cell {
      position: relative;
      font-weight: 800;
      text-transform: uppercase;
      border-radius: 0;
      overflow: hidden;
    }

    /* Ensure team text is left-aligned inside the cell */
    .entry > .team-cell {
      justify-content: flex-start;
      text-align: left;
      padding-left: 90px;
    }

    /* Icon overlay: now uses per-team CSS variables with defaults */
    .team-cell::before {
      content: "";
      position: absolute;
      inset: 0;
      background-repeat: no-repeat;
      background-position: var(--icon-pos, 0px center);
      background-size: var(--icon-size, auto 180%);
      opacity: 0.20;
      pointer-events: none;
    }

    /* Score column: light gray background, black text */
    .score-col {
      font-size: 32px;
      font-weight: 750;
      text-align: center;
      background: #d9d9d9;
      color: #000000;
      border-radius: 0;
      justify-content: center;
    }

    .gold   { color: #ffd700; }
    .silver { color: #c0c0c0; }
    .bronze { color: #cd7f32; }

    .entry.highlight-gold     { background: rgba(255,215,0,0.18); }
    .entry.highlight-silver   { background: rgba(192,192,192,0.18); }
    .entry.highlight-bronze   { background: rgba(205,127,50,0.18); }
    .entry.highlight-default  { background: rgba(52,211,153,0.20); }

    .loading, .error {
      width: 100%;
      text-align: center;
      font-size: 28px;
    }

    /* Per-team tweak handles:
       - background-image (icon file)
       - optional overrides for --icon-pos / --icon-size
       All are initialized to match current visual exactly.
    */

    .team-animals {
    }
    .team-animals::before {
      background-image: url("icons/animals.png");
    }
    .team-terrific-tigers {
    }
    .team-terrific-tigers::before {
      background-image: url("icons/terrific-tigers.png");
    }
    .team-breakers {
      --icon-opacity: 0.45;
    }
    .team-breakers::before {
      background-image: url("icons/breakers.png");
    }
    .team-daggers {
    }
    .team-daggers::before {
      background-image: url("icons/daggers.png");
    }
    .team-snipers {
      --icon-size: 220%;
    }
    .team-snipers::before {
      background-image: url("icons/snipers.png");
    }
    .team-mcstrokers {
      --icon-pos: 0 55%;
      --icon-size: 190%;
    }
    .team-mcstrokers::before {
      background-image: url("icons/mcstrokers.png");
    }

    .team-asterism {
    }
    .team-asterism::before {
      background-image: url("icons/asterism.png");
    }
    .team-double-eagles {
      --icon-pos: 0 40%;
    }
    .team-double-eagles::before {
      background-image: url("icons/double-eagles.png");
    }
    .team-phantom-troupe {
      --icon-size: 200%;
      --icon-pos: 0 45%;
    }
    .team-phantom-troupe::before {
      background-image: url("icons/phantom-troupe.png");
    }
    .team-spocco-cows {
      --icon-pos: 0 40%;
      --icon-size: auto 190%;
    }
    .team-spocco-cows::before {
      background-image: url("icons/spocco-cows.png");
    }
    .team-infernix {
    }
    .team-infernix::before {
      background-image: url("icons/infernix.png");
    }
    .team-carrots {
    }
    .team-carrots::before {
      background-image: url("icons/carrots.png");
    }
  </style>
</head>

<body>
<div class="card" id="card">
  <div class="title">Season 5 Team Standings</div>

  <div class="header-row">
    <span>Rank</span>
    <span>Team</span>
    <span>Score</span>
  </div>

  <div id="resultsList">
    <div class="loading">Loading…</div>
  </div>
</div>

<script>
  const WORKER_URL  = "https://small-mud-2771.nextweekmedia.workers.dev/";
  const SHEET_ID    = "1qIM0HKhx9Y-3eCJCFzBqrbATwiPrK3C1ynATwZzRC1o";
  const RANGE_TEAMS = "Season 5!U4:X15";

  const REFRESH_MS  = 15000;
  const TEAM_NAME   = new URLSearchParams(location.search).get("team");

  const ROW_H    = 60;
  const TITLE_H  = 46 + 16;
  const HEADER_H = 46 + 10;
  const CARD_H   = 880;

  let lastState = null;

  // Exact Season 5 team colors (source of truth)
  const TEAM_STYLES = {
    "ANIMALS":         { bg: "#cd7f32", fg: "#ffffff" },
    "TERRIFIC TIGERS": { bg: "#fe6d01", fg: "#000000" },
    "BREAKERS":        { bg: "#f1c232", fg: "#1c4487" },
    "DAGGERS":         { bg: "#ea9999", fg: "#0f0d36" },
    "SNIPERS":         { bg: "#275318", fg: "#ffe6cd" },
    "MCSTROKERS":      { bg: "#4d94d8", fg: "#ffffff" },
    "ASTERISM":        { bg: "#ba2636", fg: "#ffffff" },
    "DOUBLE-EAGLES":   { bg: "#1c4487", fg: "#ffffff" },
    "PHANTOM TROUPE":  { bg: "#674ea7", fg: "#ffffff" },
    "SPOCCO COWS":     { bg: "#77206d", fg: "#ffffff" },
    "INFERNIX*":        { bg: "#f6b26b", fg: "#000000" },
    "CARROTS":         { bg: "#ff9966", fg: "#000000" }
  };

  function getTeamStyle(name) {
    if (!name) return null;
    const key = String(name).trim().toUpperCase();
    return TEAM_STYLES[key] || null;
  }

  async function fetchRange(range) {
    const url = `${WORKER_URL}?sheetId=${SHEET_ID}&range=${encodeURIComponent(range)}`;
    const res = await fetch(url);
    const json = await res.json();
    return json.values || [];
  }

  function adjustSpacing(rowCount) {
    const resultsList = document.getElementById("resultsList");
    const card = document.getElementById("card");

    const content = rowCount * ROW_H;
    const remain  = CARD_H - TITLE_H - HEADER_H - content;
    const gaps    = Math.max(0, rowCount - 1);
    const gap     = gaps > 0 ? Math.max(4, (remain * 0.33) / gaps) : 0;
    const pad     = (remain - (gap * gaps)) / 2;

    resultsList.style.gap = `${gap}px`;
    card.style.paddingTop = `${32 + pad}px`;
    card.style.paddingBottom = `${40 + pad}px`;
  }

  function slugify(name) {
    return String(name)
      .trim()
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, "-")
      .replace(/^-|-$/g, "");
  }

  function render(list) {
    const el = document.getElementById("resultsList");
    el.innerHTML = "";

    list.forEach(team => {
      const row = document.createElement("div");
      row.className = "entry";

      const clr =
        team.rank === 1 ? "gold" :
        team.rank === 2 ? "silver" :
        team.rank === 3 ? "bronze" : "";

      if (TEAM_NAME && team.name.toLowerCase() === TEAM_NAME.toLowerCase()) {
        row.classList.add(
          team.rank === 1 ? "highlight-gold" :
          team.rank === 2 ? "highlight-silver" :
          team.rank === 3 ? "highlight-bronze" :
          "highlight-default"
        );
      }

      const style = getTeamStyle(team.name) || {};
      const teamBg = style.bg || "rgba(255,255,255,0.08)";
      const teamFg = style.fg || "#ffffff";

      row.innerHTML = `
        <span class="place ${clr}">${team.rank}</span>
        <span class="player-name team-cell team-${team.slug}"
              style="background:${teamBg};color:${teamFg};">
          ${team.name}
        </span>
        <span class="score-col">${team.score != null ? team.score : "—"}</span>
      `;

      el.appendChild(row);
    });

    adjustSpacing(list.length);
  }

  function normalize(rows) {
    // rows: [rank, ?, teamName, score, ...]
    return rows
      .map(r => {
        const rank  = r[0];
        const name  = r[2];
        const score = r[3];

        if (!rank || !name) return null;

        return {
          rank: Number(rank),
          id: name,
          name,
          slug: slugify(name),
          score: score !== undefined && score !== "" ? Number(score) : null
        };
      })
      .filter(Boolean)
      .sort((a, b) => a.rank - b.rank);
  }

  async function update() {
    try {
      const rows = await fetchRange(RANGE_TEAMS);
      const mapped = normalize(rows);
      const view = mapped;

      if (!lastState || JSON.stringify(view) !== JSON.stringify(lastState)) {
        const el = document.getElementById("resultsList");
        el.style.opacity = "0";
        setTimeout(() => {
          render(view);
          lastState = view;
          requestAnimationFrame(() => (el.style.opacity = "1"));
        }, 250);
      }
    } catch (err) {
      document.getElementById("resultsList").innerHTML =
        `<div class="error">${err.message}</div>`;
    }
  }

  update();
  setInterval(update, REFRESH_MS);
</script>
</body>
</html>
